/**
 * Registra a data do último login do usuário
 * Adiciona uma coluna "Último Login" na tela de "Todos os Usuários"
 * Preenche a coluna com a data do "Último Login"
 * Exibe a data do último login na página de perfil do usuário
 */

// Registra a data do último login do usuário
function custom_track_user_last_login($user_login, $user) {
    update_user_meta($user->ID, 'user_last_login', current_time('mysql'));
}
add_action('wp_login', 'custom_track_user_last_login', 10, 2);

// Adiciona uma coluna personalizada na tela de "Todos os Usuários"
function custom_add_last_login_column($columns) {
    $columns['last_login'] = 'Último Login';
    return $columns;
}
add_filter('manage_users_columns', 'custom_add_last_login_column');

// Preenche a coluna com a data do último login
function custom_show_last_login_column($value, $column_name, $user_id) {
    if ($column_name === 'last_login') {
        $last_login = get_user_meta($user_id, 'user_last_login', true);
        return $last_login ? date('d/m/Y', strtotime($last_login)) : 'N/A';
    }
    return $value;
}
add_action('manage_users_custom_column', 'custom_show_last_login_column', 10, 3);

// Exibe a data do último login na página de perfil do usuário
function custom_show_last_login_field($user) {
    $last_login = get_user_meta($user->ID, 'user_last_login', true);
    ?>
    <table class="form-table">
        <tr>
            <th><label for="user_last_login">Último Login</label></th>
            <td>
                <?php echo $last_login ? date('d/m/Y H:i:s', strtotime($last_login)) : 'N/A'; ?>
            </td>
        </tr>
    </table>
    <?php
}
add_action('show_user_profile', 'custom_show_last_login_field');
add_action('edit_user_profile', 'custom_show_last_login_field');
